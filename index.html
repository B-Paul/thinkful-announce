<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script type="text/javascript">
    var slackApiKey        = 'xoxp-2442078175-3326376290-3725937040-91e5d7',
        googleApiKey       = 'AIzaSyCSYzqlibFyFE93jd_amSQTWDzZ54g0Su4',
        googleClientId     = '549978578689-gth04j75b4e3g9tme2a983hni8l50775'
                           + '.apps.googleusercontent.com',
        googleScopes       = 'https://spreadsheets.google.com/feeds '
                           + 'https://docs.google.com/feeds',
        officeHoursSheetId = '1dbQ5XLk8k83b1Za3Ugmp4PW-9QKaW9j46Pmd0fLT96Y';

    
    function authorize() {
      gapi.client.setApiKey(googleApiKey);
      setTimeout(authorize2, 1);
    }

    function authorize2(usePopUp) {
      var request = {
        client_id: googleClientId,
        scope: googleScopes,
        immediate: !usePopUp
      };

      console.log(request);

      function checkAuth(authResult) {
        console.log(authResult);
        if (!authResult || authResult.error) {
          console.log('ok summat\'s wrong');
          if (!usePopUp) { return authorize2(true); }
          console.log('we were using the popup, so we aint gonna retry');
          throw new Error('Authentication error');
        }
        document.dispatchEvent(new Event('tf-gapi-auth'));
      };

      console.log('Im about to call gapi');
      gapi.auth.authorize(request, checkAuth);
      console.log('Done with that');
    }

    document.addEventListener('tf-gapi-auth', function () {
      console.log('success!');
    });
  </script>
  <script
    type="text/javascript"
    src="https://apis.google.com/js/client.js?onload=authorize">
  </script>
</head>
<body>
  
</body>
</html>